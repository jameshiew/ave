---
stages:
  - lint
  - test

variables:
  CARGO_HOME: $CI_PROJECT_DIR/cargo

cache:
  paths:
    - cargo/

rustfmt:
  image: rust:1.42.0
  stage: lint
  script:
    - rustup component add rustfmt
    - cargo fmt -- --check

run tests:
  image: rust:1.42.0
  stage: test
  script:
    - cargo check --release --verbose --all
    - cargo build --release --verbose --all
    - cargo test --release --verbose --all
  artifacts:
    paths:
      - target/release/ave
